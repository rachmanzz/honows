"use strict";var s=require("nanoid"),e=require("./session/map.cjs"),n=require("./session/channels.cjs");const t=new WeakMap;exports.createWs=()=>({sessionRegister(n){if(!t.has(this)){const i="wss"+s.nanoid(20);t.set(this,i),e.createSession(i,n)}},sessionRemove(){const s=t.get(this);s&&(e.removeSession(s),t.delete(this))},sessionID(){return t.get(this)},getWS(){const s=t.get(this);if(s)return e.getWs(s)},subscribe(s){const e=this.sessionID();e&&n.addChannelItem(s,e)},unsubscribe(s){const e=this.sessionID();e&&n.removeChannelItem(s,e)},channelSend(s,t){const i=this.sessionID();i&&n.hasInChannel(s,i)&&n.getChannels(s)?.forEach((s=>{i!==s&&e.getWs(s)?.send(t)}))}});
