import{nanoid as s}from"nanoid";import{getWs as e,removeSession as t,createSession as n}from"./session/map.mjs";import{hasInChannel as i,getChannels as o,removeChannelItem as r,addChannelItem as h}from"./session/channels.mjs";const c=new WeakMap,m=()=>({sessionRegister(e){if(!c.has(this)){const t="wss"+s(20);c.set(this,t),n(t,e)}},sessionRemove(){const s=c.get(this);s&&(t(s),c.delete(this))},sessionID(){return c.get(this)},getWS(){const s=c.get(this);if(s)return e(s)},subscribe(s){const e=this.sessionID();e&&h(s,e)},unsubscribe(s){const e=this.sessionID();e&&r(s,e)},channelSend(s,t){const n=this.sessionID();n&&i(s,n)&&o(s)?.forEach((s=>{n!==s&&e(s)?.send(t)}))}});export{m as createWs};
